<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="501px" preserveAspectRatio="none" style="width:728px;height:501px;background:#FFFFFF;" version="1.1" viewBox="0 0 728 501" width="728px" zoomAndPan="magnify"><defs><linearGradient id="g1ceksgy7qw4dp0" x1="0%" x2="100%" y1="0%" y2="100%"><stop offset="0%" stop-color="#FFFF00"/><stop offset="100%" stop-color="#008000"/></linearGradient><linearGradient id="g1ceksgy7qw4dp1" x1="0%" x2="100%" y1="0%" y2="100%"><stop offset="0%" stop-color="#FFFF00"/><stop offset="100%" stop-color="#0000FF"/></linearGradient></defs><g><rect fill="#0000FF" height="320.5938" style="stroke:#181818;stroke-width:1.0;" width="10" x="180.5" y="91.2969"/><rect fill="#FFA500" height="59.3984" style="stroke:#181818;stroke-width:1.0;" width="10" x="552.5" y="314.3594"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="44" x2="44" y1="81.2969" y2="420.8906"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="185.5" x2="185.5" y1="81.2969" y2="420.8906"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="361" x2="361" y1="81.2969" y2="420.8906"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="557.5" x2="557.5" y1="81.2969" y2="420.8906"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="689" x2="689" y1="81.2969" y2="420.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="73" x="5" y="77.9951">Alice's app</text><ellipse cx="44.5" cy="13.5" fill="url(#g1ceksgy7qw4dp0)" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M44.5,21.5 L44.5,48.5 M31.5,29.5 L57.5,29.5 M44.5,48.5 L31.5,63.5 M44.5,48.5 L57.5,63.5 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="73" x="5" y="432.8857">Alice's app</text><ellipse cx="44.5" cy="444.6875" fill="url(#g1ceksgy7qw4dp0)" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M44.5,452.6875 L44.5,479.6875 M31.5,460.6875 L57.5,460.6875 M44.5,479.6875 L31.5,494.6875 M44.5,479.6875 L57.5,494.6875 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#ADD8E6" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="118" x="126.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="104" x="133.5" y="69.9951">Bob's mediator</text><rect fill="#ADD8E6" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="118" x="126.5" y="419.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="104" x="133.5" y="439.8857">Bob's mediator</text><rect fill="#ADD8E6" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="51" x="336" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="37" x="343" y="69.9951">Relay</text><rect fill="#ADD8E6" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="51" x="336" y="419.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="37" x="343" y="439.8857">Relay</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="120" x="494.5" y="77.9951">Firebase Console</text><ellipse cx="557.5" cy="49" fill="#ADD8E6" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/><line style="stroke:#181818;stroke-width:0.5;" x1="545.5" x2="569.5" y1="63" y2="63"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="120" x="494.5" y="432.8857">Firebase Console</text><ellipse cx="557.5" cy="452.1875" fill="#ADD8E6" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/><line style="stroke:#181818;stroke-width:0.5;" x1="545.5" x2="569.5" y1="466.1875" y2="466.1875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="69" x="652" y="77.9951">Bob's app</text><ellipse cx="689.5" cy="13.5" fill="url(#g1ceksgy7qw4dp1)" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M689.5,21.5 L689.5,48.5 M676.5,29.5 L702.5,29.5 M689.5,48.5 L676.5,63.5 M689.5,48.5 L702.5,63.5 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="69" x="652" y="432.8857">Bob's app</text><ellipse cx="689.5" cy="444.6875" fill="url(#g1ceksgy7qw4dp1)" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M689.5,452.6875 L689.5,479.6875 M676.5,460.6875 L702.5,460.6875 M689.5,479.6875 L676.5,494.6875 M689.5,479.6875 L702.5,494.6875 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#0000FF" height="320.5938" style="stroke:#181818;stroke-width:1.0;" width="10" x="180.5" y="91.2969"/><rect fill="#FFA500" height="59.3984" style="stroke:#181818;stroke-width:1.0;" width="10" x="552.5" y="314.3594"/><polygon fill="#0000FF" points="168.5,108.4297,178.5,112.4297,168.5,116.4297,172.5,112.4297" style="stroke:#0000FF;stroke-width:1.0;"/><line style="stroke:#0000FF;stroke-width:1.0;" x1="44.5" x2="174.5" y1="112.4297" y2="112.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="112" x="51.5" y="107.3638">1. Send message</text><line style="stroke:#0000FF;stroke-width:2.0;" x1="671.5" x2="681.5" y1="136.5625" y2="146.5625"/><line style="stroke:#0000FF;stroke-width:2.0;" x1="671.5" x2="681.5" y1="146.5625" y2="136.5625"/><line style="stroke:#0000FF;stroke-width:1.0;" x1="190.5" x2="676.5" y1="141.5625" y2="141.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="162" x="197.5" y="136.4966">2. Deliver message (fails)</text><line style="stroke:#0000FF;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="190.5" x2="232.5" y1="170.6953" y2="170.6953"/><line style="stroke:#0000FF;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="232.5" x2="232.5" y1="170.6953" y2="183.6953"/><line style="stroke:#0000FF;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="191.5" x2="232.5" y1="183.6953" y2="183.6953"/><polygon fill="#0000FF" points="201.5,179.6953,191.5,183.6953,201.5,187.6953,197.5,183.6953" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121" x="197.5" y="165.6294">3. Queue message</text><polygon fill="#0000FF" points="349.5,223.9609,359.5,227.9609,349.5,231.9609,353.5,227.9609" style="stroke:#0000FF;stroke-width:1.0;"/><line style="stroke:#0000FF;stroke-width:1.0;" x1="190.5" x2="355.5" y1="227.9609" y2="227.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="147" x="197.5" y="207.7622">4. Event: Undeliverable</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="59" x="201.5" y="222.895">message</text><line style="stroke:#0000FF;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="361.5" x2="403.5" y1="272.2266" y2="272.2266"/><line style="stroke:#0000FF;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="403.5" x2="403.5" y1="272.2266" y2="285.2266"/><line style="stroke:#0000FF;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="362.5" x2="403.5" y1="285.2266" y2="285.2266"/><polygon fill="#0000FF" points="372.5,281.2266,362.5,285.2266,372.5,289.2266,368.5,285.2266" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="154" x="368.5" y="252.0278">5. Look up device_token</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126" x="372.5" y="267.1606">using connection_id</text><polygon fill="#0000FF" points="540.5,310.3594,550.5,314.3594,540.5,318.3594,544.5,314.3594" style="stroke:#0000FF;stroke-width:1.0;"/><line style="stroke:#0000FF;stroke-width:1.0;" x1="361.5" x2="546.5" y1="314.3594" y2="314.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="172" x="368.5" y="309.2935">6. Notifies firebase console</text><polygon fill="#0000FF" points="568.5,369.7578,558.5,373.7578,568.5,377.7578,564.5,373.7578" style="stroke:#0000FF;stroke-width:1.0;"/><line style="stroke:#0000FF;stroke-width:1.0;" x1="562.5" x2="688.5" y1="373.7578" y2="373.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="75" x="574.5" y="338.4263">7. Retrieves</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103" x="574.5" y="353.5591">pushNotification</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="75" x="574.5" y="368.6919">with msg_id</text><polygon fill="#FF0000" points="372.5,398.8906,362.5,402.8906,372.5,406.8906,368.5,402.8906" style="stroke:#FF0000;stroke-width:1.0;"/><polygon fill="#FF0000" points="677.5,398.8906,687.5,402.8906,677.5,406.8906,681.5,402.8906" style="stroke:#FF0000;stroke-width:1.0;"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="366.5" x2="683.5" y1="402.8906" y2="402.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137" x="378.5" y="397.8247">8.pickup protocol flow</text><!--MD5=[7d0d673bd056142bf3bd701c5a985003]
@startuml
actor "Alice's app" as al #yellow/green
participant "Bob's mediator" as ned #lightblue
participant "Relay" as rel #lightblue
entity "Firebase Console" as fc #lightblue
actor "Bob's app" as app #yellow/blue


activate ned #blue
al -[#blue]> ned: 1. Send message
ned -[#blue]x app: 2. Deliver message (fails)
ned - -[#blue]> ned: 3. Queue message
ned -[#blue]> rel: 4. Event: Undeliverable\n message
rel - -[#blue]> rel: 5. Look up device_token\n using connection_id
rel -[#blue]> fc: 6. Notifies firebase console
activate fc #orange
fc <-[#blue] app: 7. Retrieves \npushNotification\nwith msg_id
deactivate fc #orange
app <-[#red]> rel: 8.pickup protocol flow
@enduml

PlantUML version 1.2022.5(Sat Apr 30 10:55:52 UTC 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>