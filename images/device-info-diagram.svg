<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="430px" preserveAspectRatio="none" style="width:541px;height:430px;background:#FFFFFF;" version="1.1" viewBox="0 0 541 430" width="541px" zoomAndPan="magnify"><defs><linearGradient id="g1qc3ote9cx9qe0" x1="0%" x2="100%" y1="0%" y2="100%"><stop offset="0%" stop-color="#FFFF00"/><stop offset="100%" stop-color="#0000FF"/></linearGradient><linearGradient id="g1qc3ote9cx9qe1" x1="0%" x2="100%" y1="0%" y2="100%"><stop offset="0%" stop-color="#FFFF00"/><stop offset="100%" stop-color="#008000"/></linearGradient></defs><g><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="42" x2="42" y1="81.2969" y2="349.625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="186.5" x2="186.5" y1="81.2969" y2="349.625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="280.5" x2="280.5" y1="81.2969" y2="349.625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="500.5" x2="500.5" y1="81.2969" y2="349.625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="69" x="5" y="77.9951">Bob's app</text><ellipse cx="42.5" cy="13.5" fill="url(#g1qc3ote9cx9qe0)" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M42.5,21.5 L42.5,48.5 M29.5,29.5 L55.5,29.5 M42.5,48.5 L29.5,63.5 M42.5,48.5 L55.5,63.5 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="69" x="5" y="361.6201">Bob's app</text><ellipse cx="42.5" cy="373.4219" fill="url(#g1qc3ote9cx9qe0)" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M42.5,381.4219 L42.5,408.4219 M29.5,389.4219 L55.5,389.4219 M42.5,408.4219 L29.5,423.4219 M42.5,408.4219 L55.5,423.4219 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#ADD8E6" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="118" x="127.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="104" x="134.5" y="69.9951">Bob's mediator</text><rect fill="#ADD8E6" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="118" x="127.5" y="348.625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="104" x="134.5" y="368.6201">Bob's mediator</text><rect fill="#ADD8E6" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="51" x="255.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="37" x="262.5" y="69.9951">Relay</text><rect fill="#ADD8E6" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="51" x="255.5" y="348.625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="37" x="262.5" y="368.6201">Relay</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="73" x="461.5" y="77.9951">Alice's app</text><ellipse cx="501" cy="13.5" fill="url(#g1qc3ote9cx9qe1)" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M501,21.5 L501,48.5 M488,29.5 L514,29.5 M501,48.5 L488,63.5 M501,48.5 L514,63.5 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="73" x="461.5" y="361.6201">Alice's app</text><ellipse cx="501" cy="373.4219" fill="url(#g1qc3ote9cx9qe1)" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M501,381.4219 L501,408.4219 M488,389.4219 L514,389.4219 M501,408.4219 L488,423.4219 M501,408.4219 L514,423.4219 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><polygon fill="#181818" points="174.5,108.4297,184.5,112.4297,174.5,116.4297,178.5,112.4297" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="42.5" x2="180.5" y1="112.4297" y2="112.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120" x="49.5" y="107.3638">Request mediation</text><polygon fill="#181818" points="53.5,137.5625,43.5,141.5625,53.5,145.5625,49.5,141.5625" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="47.5" x2="185.5" y1="141.5625" y2="141.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116" x="59.5" y="136.4966">Mediation granted</text><polygon fill="#181818" points="489,166.6953,499,170.6953,489,174.6953,493,170.6953" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="42.5" x2="495" y1="170.6953" y2="170.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="207" x="49.5" y="165.6294">Invite with mediator routing keys</text><polygon fill="#181818" points="269,226.0938,279,230.0938,269,234.0938,273,230.0938" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="42.5" x2="275" y1="230.0938" y2="230.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96" x="49.5" y="194.7622">Set-device-info</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="49.5" y="209.895">(device_token and</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="93" x="53.5" y="225.0278">connection_id)</text><line style="stroke:#181818;stroke-width:1.0;" x1="281" x2="323" y1="274.3594" y2="274.3594"/><line style="stroke:#181818;stroke-width:1.0;" x1="323" x2="323" y1="274.3594" y2="287.3594"/><line style="stroke:#181818;stroke-width:1.0;" x1="282" x2="323" y1="287.3594" y2="287.3594"/><polygon fill="#181818" points="292,283.3594,282,287.3594,292,291.3594,288,287.3594" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="152" x="288" y="254.1606">Store device_token with</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="206" x="288" y="269.2935">connection_id in a DeviceRecord</text><polygon fill="#181818" points="53.5,327.625,43.5,331.625,53.5,335.625,49.5,331.625" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="47.5" x2="280" y1="331.625" y2="331.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104" x="59.5" y="311.4263">Device-info-msg</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="32" x="63.5" y="326.5591">(ack)</text><!--MD5=[576cd022e0e504702a1d439e86cda747]
@startuml
actor "Bob's app" as bob #yellow/blue
participant "Bob's mediator" as med #lightblue
participant "Relay" as relay #lightblue
actor "Alice's app" as al #yellow/green

bob -> med: Request mediation
med -> bob: Mediation granted
bob -> al: Invite with mediator routing keys
bob -> relay: Set-device-info \n(device_token and\n connection_id)
relay -> relay: Store device_token with \nconnection_id in a DeviceRecord
bob <- relay: Device-info-msg\n (ack)
@enduml

PlantUML version 1.2022.5(Sat Apr 30 10:55:52 UTC 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>